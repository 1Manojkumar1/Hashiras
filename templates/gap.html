{% extends "base.html" %}

{% block title %}Gap Analyzer - CurrHub{% endblock %}

{% block content %}
<div class="entry-animation app-container">
    <div class="container">
        <!-- Hero Section -->
        <div class="hero" style="padding: 3rem 0 2rem;">
            <h1>üîç Industry-Academic Gap Analyzer</h1>
            <p>Compare your curriculum against real job requirements to identify skill gaps and improvement areas.</p>
        </div>

        <!-- Input Section -->
        <div class="gap-grid"
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; max-width: 1200px; margin: 0 auto;">
            <!-- Curriculum Input -->
            <div class="card">
                <h3><i class="fas fa-graduation-cap" style="color: #6366f1;"></i> Your Curriculum</h3>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Paste your curriculum summary or course list
                    below:</p>
                <textarea id="curriculumInput" class="gap-textarea" placeholder="Example:
B.Tech Computer Science Curriculum:

Semester 1: Programming Fundamentals, Mathematics I, Digital Logic
Semester 2: Data Structures, OOP, Discrete Mathematics
Semester 3: Algorithms, Database Systems, Computer Networks
Semester 4: Operating Systems, Software Engineering, Web Development
Semester 5: Machine Learning, Cloud Computing, Cybersecurity
Semester 6: Deep Learning, Big Data, Mobile Development
Semester 7: Capstone Project, Industry Internship
Semester 8: Final Project, Electives"></textarea>
            </div>

            <!-- Job Description Input -->
            <div class="card">
                <h3><i class="fas fa-briefcase" style="color: #10b981;"></i> Job Description</h3>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Paste the target job description:</p>
                <textarea id="jobInput" class="gap-textarea" placeholder="Example:
Software Engineer at Google

Requirements:
- Strong programming skills in Python, Java, or C++
- Experience with data structures and algorithms
- Knowledge of system design and distributed systems
- Familiarity with cloud platforms (GCP, AWS, Azure)
- Understanding of machine learning concepts
- Experience with Docker and Kubernetes
- Strong problem-solving abilities
- Excellent communication skills

Nice to have:
- Open source contributions
- Experience with CI/CD pipelines
- Knowledge of microservices architecture"></textarea>
            </div>
        </div>

        <!-- Analyze Button -->
        <div style="text-align: center; margin: 2rem 0;">
            <button id="analyzeBtn" class="btn-primary" onclick="analyzeGap()">
                <i class="fas fa-search-plus"></i> Analyze Gap
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" style="display: none;">
            <div class="card" style="max-width: 900px; margin: 0 auto;">
                <h3><i class="fas fa-chart-bar" style="color: #6366f1;"></i> Gap Analysis Report</h3>
                <div id="analysisResult" class="analysis-content"></div>
                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn-secondary" onclick="copyAnalysis()">
                        <i class="fas fa-copy"></i> Copy Report
                    </button>
                    <button class="btn-secondary" onclick="downloadAnalysis()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingGap" style="display: none; text-align: center; padding: 2rem;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #6366f1;"></i>
            <p style="margin-top: 1rem; color: var(--text-muted);">Analyzing curriculum vs job requirements...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function analyzeGap() {
        const curriculum = document.getElementById('curriculumInput').value.trim();
        const job = document.getElementById('jobInput').value.trim();

        if (!curriculum || !job) {
            alert('Please provide both curriculum and job description.');
            return;
        }

        const loading = document.getElementById('loadingGap');
        const results = document.getElementById('resultsSection');
        const btn = document.getElementById('analyzeBtn');

        btn.disabled = true;
        loading.style.display = 'block';
        results.style.display = 'none';

        try {
            const response = await fetch('/analyze-gap', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    curriculum_summary: curriculum,
                    job_description: job
                })
            });

            const data = await response.json();

            document.getElementById('analysisResult').innerHTML = formatMarkdown(data.analysis);
            results.style.display = 'block';
            results.scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            alert('Error analyzing gap. Please try again.');
            console.error(error);
        } finally {
            loading.style.display = 'none';
            btn.disabled = false;
        }
    }

    function formatMarkdown(text) {
        return text
            .replace(/## (.*)/g, '<h3>$1</h3>')
            .replace(/### (.*)/g, '<h4>$1</h4>')
            .replace(/#### (.*)/g, '<h5>$1</h5>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/‚úÖ/g, '<span style="color: #10b981;">‚úÖ</span>')
            .replace(/‚ö†Ô∏è/g, '<span style="color: #f59e0b;">‚ö†Ô∏è</span>')
            .replace(/‚ùå/g, '<span style="color: #ef4444;">‚ùå</span>')
            .replace(/\n- /g, '<br>‚Ä¢ ')
            .replace(/\n\d+\. /g, (match) => '<br>' + match.trim() + ' ')
            .replace(/\n\n/g, '<br><br>')
            .replace(/\n/g, '<br>');
    }

    function copyAnalysis() {
        const text = document.getElementById('analysisResult').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert('Report copied to clipboard!');
        });
    }

    function downloadAnalysis() {
        const text = document.getElementById('analysisResult').innerText;
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'gap-analysis-report.txt';
        a.click();
        URL.revokeObjectURL(url);
    }
</script>
{% endblock %}